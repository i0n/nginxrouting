server {
	server_name nginxrouting.dev.gov.uk;
	root /var/govuk/nginxrouting/public;

	location = /blah {
		add_header pre_redirect yes;
		return 200;
	}

	location / {
		if ($request_uri ~* ".*(itemid=[0-9]*){1}.*") {
			set $itemid $1;
		}	
		if ($request_uri ~* ".*(topicid=[0-9]*){1}.*") {
			set $topicid $1;
		}	
		if ($request_uri ~* ".*(&type=RESOURCES){1}.*") {
			set $resources $1;
		}	
		add_header itemid $itemid;
		add_header topicid $topicid;
		add_header resources $resources;
		rewrite ^ http://nginxrouting_destination.dev.gov.uk/$itemid$topicid$resources redirect;
	}
}

server {
	server_name nginxrouting_destination.dev.gov.uk;
	root var/govuk/nginxrouting/public_destination;
}
